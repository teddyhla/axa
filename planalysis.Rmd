---
title: "Preliminary Analysis"
author: "teddyhla"
date: "25/01/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Source of Data

This document details the data cleaning and pre-liminary analysis of anti Xa measurements on VV ecmo patients. 

Three cohorts of VV ecmo patients are identified :- 
- wave 1 of covid - 19, defined as between 01-03-2020 to 31-08-2020 inclusive.
- wave 2 of covid - 19, defined as between 01-09-2020 to 01-03-2021 inclusive.
- historical flu, defined as 01-01-2015 and 31-12-2019 inclusive. 

## Questions
- what about non covid and non flu patients in this period?
- what about large gaps - is it true?
- what about lmwh / flolan / argotraban ? 
- mrn 6960892X as admission date = as discharge date ? typo
- 6842347C has wrong time to cannulation, 
the rest may be one day off ? - 6578155C,6578347K,1087895N,6939825N have issues.

- for looking at labs data,6381359H (missing data 3 days on blood),6855512Y(missing data 2/3 days pre),6855430Y,6922730D,6971769E
- for looking at labs data duration , 
- ecmo run time as gold standard? 

## Sensecheck 
- no repeat admissions?
- peak 3 ecmo admission in 24 hour ?


## Patient identification
- ecmo blood pump speed was calculated from min to max dates and substracted to get ecmo run times and patients

## Heparin administration
Heparin was administered in 4 different formats 
- heparin units/hr
- heparin ecmo xa iv infusion units/kg/hr
- heparin iv injection units
- heprin rrt inf 2000 iu units
- heparin systemic inf 2000 units units/hr

weight is also extracted to calculate units/hr/hr 

## Coagulation lab results
- anti Xa and APTTR results were extracted

## Bleeding scores are extracted from ICIP. 


# Source the cleaned files
```{r}
source("datatidy.R")
```

# Cleaning Pt 

```{r}
head(pt)
summary(pt)
```

```{r}
ggplot(data = pt, aes(x=AdmissionDate))+
               geom_freqpoly(binwidth = 86400)
```

```{r}
pt %>% 
        count(mrn) %>%
        filter(n>1)
```

crude mortality rate per waves
```{r}
pt %>% 
        select(cohort,survivedecmo) %>% 
        group_by(cohort) %>% 
        summarise(totalno = n(),
        deathsonecmo = sum(survivedecmo == "no"),
        cmr = deathsonecmo/totalno)
        
```

5 number summary per waves